$(document).ready(function(){function e(){if(""===document.getElementById("nickname").value)alert("Please input your name!");else{L=new XMLHttpRequest;var e="scoreupdate.php";if(e+="?nickname="+document.getElementById("nickname").value+"&score="+j,L.open("GET",e,!0),L.send(null),"&#"==document.getElementById("nickname").value.substring(0,2))var t=document.getElementById("nickname").value.substring(0,120);else var t=document.getElementById("nickname").value.substring(0,22);document.getElementById("namefield").innerHTML=t;var n=document.getElementById("submit");n.parentNode.removeChild(n),$("#newfield").effect("highlight",{color:"#996633"},2e3)}}function t(){S=new XMLHttpRequest,S.onreadystatechange=function(){(4==S.readyState||"complete"==S.readyState)&&(result=JSON.parse(S.responseText),tt=result[14].score)},S.open("GET","scorerecieve.php",!1),S.send(null)}function n(){S=new XMLHttpRequest,S.onreadystatechange=function(){if(4==S.readyState||"complete"==S.readyState){var e=JSON.parse(S.responseText);document.getElementById("dialog").innerHTML=d(e)}},S.open("GET","scorerecieve.php",!0),S.send(null),i()}function d(e){for(var t="<table style='width:100%'><tr><td>Ranking</td><td>Name</td><td>Score</td></tr>",n=15,d=1,a=0;n>a;a++)t+=1==d?"<tr><td>"+d+"<img src='/avoidthepoop/images/goldmedal.png'/></td><td>"+e[a].nickname+"</td><td>"+e[a].score+"</td></tr>":2==d?"<tr><td>"+d+"<img src='/avoidthepoop/images/silvermedal.png'/></td><td>"+e[a].nickname+"</td><td>"+e[a].score+"</td></tr>":3==d?"<tr><td>"+d+"<img src='/avoidthepoop/images/bronzemedal.png'/></td><td>"+e[a].nickname+"</td><td>"+e[a].score+"</td></tr>":"<tr><td>"+d+"</td><td>"+e[a].nickname+"</td><td>"+e[a].score+"</td></tr>",d++;return t+="</table>"}function a(e){for(var t="<table style='width:100%'><tr><td>Ranking</td><td>Name</td><td>Score</td></tr>",n=15,d=!1,a=1,i=0;n>i;i++)e[i].score>j?t+=1==a?"<tr><td>"+a+"<img src='/avoidthepoop/images/goldmedal.png'/></td><td>"+e[i].nickname+"</td><td>"+e[i].score+"</td></tr>":2==a?"<tr><td>"+a+"<img src='/avoidthepoop/images/silvermedal.png'/></td><td>"+e[i].nickname+"</td><td>"+e[i].score+"</td></tr>":3==a?"<tr><td>"+a+"<img src='/avoidthepoop/images/bronzemedal.png'/></td><td>"+e[i].nickname+"</td><td>"+e[i].score+"</td></tr>":"<tr><td>"+a+"</td><td>"+e[i].nickname+"</td><td>"+e[i].score+"</td></tr>":e[i].score<=j&&!d?(t+=1==a?"<tr id='newfield'><td>"+a+"<img src='/avoidthepoop/images/goldmedal.png'/></td><td id='namefield'><input type='text' id='nickname'/></td><td>"+j+"</td></tr>":2==a?"<tr id='newfield'><td>"+a+"<img src='/avoidthepoop/images/silvermedal.png'/></td><td id='namefield'><input type='text' id='nickname'/></td><td>"+j+"</td></tr>":3==a?"<tr id='newfield'><td>"+a+"<img src='/avoidthepoop/images/bronzemedal.png'/></td><td id='namefield'><input type='text' id='nickname'/></td><td>"+j+"</td></tr>":"<tr id='newfield'><td>"+a+"</td><td id='namefield'><input type='text' id='nickname'/></td><td>"+j+"</td></tr>",i--,n--,d=!0):t+=1==a?"<tr><td>"+a+"<img src='/avoidthepoop/images/goldmedal.png'/></td><td>"+e[i].nickname+"</td><td>"+e[i].score+"</td></tr>":2==a?"<tr><td>"+a+"<img src='/avoidthepoop/images/silvermedal.png'/></td><td>"+e[i].nickname+"</td><td>"+e[i].score+"</td></tr>":3==a?"<tr><td>"+a+"<img src='/avoidthepoop/images/bronzemedal.png'/></td><td>"+e[i].nickname+"</td><td>"+e[i].score+"</td></tr>":"<tr><td>"+a+"</td><td>"+e[i].nickname+"</td><td>"+e[i].score+"</td></tr>",a++;return t+="</table><input type='button' value='Submit' id='submit'/>"}function i(){$("#dialog").dialog({draggable:!1}),$("#dialog").dialog("option","height",520),$("#dialog").dialog("option","width",500)}function r(){window.requestAnimationFrame?(document.addEventListener("keydown",f),document.addEventListener("keyup",E),document.getElementById("soundoff").addEventListener("click",function(){checked=document.getElementById("soundoff").checked,checked?(document.getElementById("soundStatus").innerHTML="Uncheck to turn sound on",document.getElementById("instrumental").pause()):(document.getElementById("soundStatus").innerHTML="Check to turn sound off",document.getElementById("instrumental").play())}),document.getElementById("play").addEventListener("click",function(){var e=document.getElementById("play");if(e.parentNode.removeChild(e),checked=document.getElementById("soundoff").checked,checked?(document.getElementById("instrumental").currentTime=0,document.getElementById("instrumental").pause()):(document.getElementById("instrumental").currentTime=0,document.getElementById("instrumental").play()),""!=document.cookie)for(var t=document.cookie.split(";"),n=0;n<t.length;n++)t[n].indexOf("maxScore")>-1&&(K=t[n].split("=")[1]);T=setInterval(o,4e3),c(document.getElementById("canvasDiv"),600,600)}),document.getElementById("showscoreboard").addEventListener("click",n),t(),document.addEventListener("touchstart",x),document.addEventListener("touchend",I)):document.write("Your browser is not compatible with this game. Please update or use a different browser.")}function o(){30==X&&clearInterval(T),Q++,X-=5,document.getElementById("levelup").currentTime=0,document.getElementById("levelup").play()}function m(){z=q,q=0}function c(e,t,n){w=document.createElement("canvas"),w.setAttribute("width",t),w.setAttribute("height",n),w.setAttribute("id","canvas"),e.appendChild(w),b=e,"undefined"!=typeof G_vmlCanvasManager&&(w=G_vmlCanvasManager.initElement(w)),k=w.getContext("2d"),l("leftleg"),l("rightleg"),l("leftarm"),l("rightarm"),l("body"),l("head"),l("poop"),g()}function l(e){C[e]=new Image,C[e].onload=function(){s()},C[e].src="images/"+e+".png"}function s(){N+=1,N===M&&v()}function u(){1===R?(G-=H,-D>G&&(R=-1)):(G+=H,G>D&&(R=1))}function g(){var e=300,t=600,n={x:e-5,y:t-47};W.push(n);var d={x:e,y:t-25};W.push(d);var a={x:e+7,y:t-10};W.push(a);var i={x:e+8,y:t-26};W.push(i);var r={x:e-7,y:t-10};W.push(r);var o={x:e-8,y:t-26};W.push(o)}function p(){var e;for(e=0;e<P.length/2;e++)P[e].y+38>W[0].y+3&&P[e].y+38<600&&P[e].x+19>W[0].x-13&&P[e].x-12<W[0].x+10&&(Y=!0)}function y(){var e=Math.random()*(w.width-30),t={x:e,y:O,t:Date.now()};P.push(t)}function h(){document.getElementById("dying").pause(),k.clearRect(0,0,w.width,w.height),Y=!1,P=[],document.getElementById("playagain").parentNode.removeChild(document.getElementById("playagain")),document.getElementById("gameover").parentNode.removeChild(document.getElementById("gameover")),document.getElementById("canvasDiv").style.opacity=1,j=0,W=[],g(),T=setInterval(o,4e3),Q=1,X=80,v()}function v(){U=Date.now(),U>F+X&&(F=U,y()),k.clearRect(0,0,w.width,w.height);var n=W[0],d=W[1],r=W[2],o=W[3],m=W[4],c=W[5];(n.x<12.5&&_>0||n.x>570&&0>_||n.x>=13&&n.x<=570)&&(n.x=n.x+_,d.x=d.x+_,r.x=r.x+_,o.x=o.x+_,m.x=m.x+_,c.x=c.x+_),k.drawImage(C.leftarm,c.x,c.y-G),k.drawImage(C.leftleg,m.x,m.y),k.drawImage(C.rightarm,o.x,o.y-G),k.drawImage(C.rightleg,r.x,r.y),k.drawImage(C.body,d.x,d.y),k.drawImage(C.head,n.x,n.y-G),k.lineWidth=1,k.fillStyle="#ad2323",k.lineStyle="#ad2323",k.font="28px sans-serif",k.fillText(K,10,20),k.fillText(j,10,60),k.fillText("Level "+Q,w.width-120,20);for(var l=0;l<P.length;l++){var s=P[l];s.y=J*Math.pow(U-s.t,2),k.drawImage(C.poop,P[l].x,P[l].y),s.y>=600&&(P.shift(),j++,j>K&&(K=j))}if(P.length>10&&p(),Y){cancelAnimationFrame(B),t(),document.getElementById("dying").currentTime=0,document.getElementById("dying").play();var u=document.getElementById("canvasinnerwrapper");document.getElementById("canvasDiv").setAttribute("style","opacity: 0.4");var g=document.createElement("span"),f=document.createTextNode("Game Over");g.setAttribute("id","gameover"),g.appendChild(f),g.setAttribute("style","position: absolute; top: 300px; margin-left: auto; margin-right:auto; left:0; right:0; font-family: sans-serif; opacity: 1;");var x=document.createElement("span"),I=document.createElement("br"),E=document.createTextNode("Click to Play Again"),b=document.createTextNode("(or press r)");x.setAttribute("id","playagain"),x.appendChild(E),x.appendChild(I),x.appendChild(b),x.setAttribute("style","position: absolute; top: 350px; margin-left: auto; margin-right:auto; left:0; right:0; font-family: sans-serif; opacity:1; z-index: 5"),u.insertBefore(x,u.childNodes[0]),u.insertBefore(g,u.childNodes[0]),k.clearRect(0,500,w.width,w.height),k.drawImage(C.leftarm,c.x+5,c.y),k.drawImage(C.leftleg,m.x-10,m.y),k.drawImage(C.rightarm,o.x-40,o.y),k.drawImage(C.rightleg,r.x+20,r.y),k.drawImage(C.body,d.x-20,d.y),k.drawImage(C.head,n.x,n.y+20),clearInterval(T);var L=new Date(2118,10,24,12);document.cookie="maxScore = "+K+"; expires = "+L.toGMTString(),j>tt&&(document.getElementById("dialog").innerHTML=a(result),document.getElementById("submit").addEventListener("click",e),i()),document.getElementById("playagain").addEventListener("click",h)}else B=requestAnimationFrame(v)}function f(e){var t=W[0];switch(e.keyCode){case 37:t.x>=12.5&&(V=!0,_=-7);break;case 39:t.x<=585&&(Z=!0,_=7);break;case 82:var n=$("#dialog").dialog("isOpen");Y&&!n&&h()}}function x(e){et=e.changedTouches[0].pageX;var t=W[0],n=window.innerWidth/2;n>=et?t.x>=12.5&&(V=!0,_=-7):t.x<=585&&(Z=!0,_=7)}function I(e){et=e.changedTouches[0].pageX;var t=window.innerWidth/2;t>et&&(V=!1,V||Z||(_=0)),et>=t&&(Z=!1,V||Z||(_=0))}function E(e){37==e.which&&(V=!1,V||Z||(_=0)),39==e.which&&(Z=!1,V||Z||(_=0))}var w,k,B,b,T,L,S,C={},M=6,N=0,A=30,H=.5,R=1,G=0,D=1,q=(setInterval(u,1e3/A),setInterval(m,1e3),0),z=0,O=25,X=100,F=-1,P=[],W=[],J=3e-4,_=0,U=0,Y=!1,j=0,K=0,Q=1,V=!1,Z=!1,et=0,tt=0;window.onload=r});